{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Receita Médica - {{ paciente.nome }}</title>
    <style>
        @page {
            size: a4 portrait;
            margin: 1.5cm;
            @frame header_frame { -pdf-frame-content: header_content; left: 1cm; width: 19cm; top: 0.5cm; height: 3cm; }
            @frame footer_frame { -pdf-frame-content: footer_content; left: 1cm; width: 19cm; top: 26.5cm; height: 2cm; }
            @frame content_frame { left: 1cm; width: 19cm; top: 4.0cm; height: 22cm; }
        }
        body { font-family: Helvetica, Arial, sans-serif; font-size: 11pt; }
        #header_content, #footer_content { text-align: center; }
        .img-header { height: 2.5cm; width: auto; }
        .titulo { text-align: center; font-size: 16pt; font-weight: bold; margin-bottom: 20px; border-bottom: 2px solid #000; padding-bottom: 5px; }
        .paciente-box { background-color: #f0f0f0; padding: 10px; margin-bottom: 20px; border: 1px solid #999; }
        .item-receita { margin-bottom: 15px; padding-bottom: 5px; border-bottom: 1px dashed #ccc; }
        .med-nome { font-weight: bold; font-size: 12pt; }
        .med-dose { font-style: italic; }
        .posologia { margin-left: 20px; margin-top: 5px; }
        .obs-box { margin-top: 20px; border: 1px solid #000; padding: 10px; min-height: 50px; font-size: 10pt; }
        .assinatura { margin-top: 50px; text-align: center; border-top: 1px solid #000; width: 60%; margin-left: auto; margin-right: auto; padding-top: 5px; }
    </style>
</head>
<body>
    <div id="header_content">
        {% if header_b64 %}<img src="data:image/png;base64,{{ header_b64 }}" class="img-header"/>{% endif %}
    </div>

    <div id="footer_content">
        <div style="font-size: 9pt; color: #666;">
            AME Caraguatatuba - Avenida Acre, 1081 - Indaiá - (12) 3889-1430<br>
            Impresso em: {{ data_hoje|date:"d/m/Y H:i" }} por {{ usuario.get_full_name }}
        </div>
    </div>

    {% if itens_comuns %}
    <div class="titulo">RECEITUÁRIO MÉDICO</div>

    <div class="paciente-box">
        <strong>Paciente:</strong> {{ paciente.nome }}<br>
        <strong>CPF:</strong> {{ paciente.cpf }} &nbsp;&nbsp; <strong>Idade:</strong> {{ idade }} anos
    </div>

    {% for item in itens_comuns %}
    <div class="item-receita">
        <div class="med-nome">
            {{ forloop.counter }}. {{ item.medicamento_nome }} {{ item.concentracao }}
            <span style="float: right;">Quant: {{ item.quantidade }}</span>
        </div>
        <div class="posologia">
            <strong>Uso:</strong> {{ item.posologia }}
        </div>
    </div>
    {% endfor %}

    {% if observacoes %}
    <div class="obs-box">
        <strong>Observações:</strong><br>
        {{ observacoes|linebreaksbr }}
    </div>
    {% endif %}

    <div class="assinatura">
        <strong>{{ usuario.get_full_name }}</strong><br>
        {{ usuario.tipo_registro }}: {{ usuario.registro_profissional }}
    </div>
    {% endif %}

    {% if itens_controlados %}
        {% if itens_comuns %}<pdf:nextpage />{% endif %}

        <div class="titulo">RECEITUÁRIO DE CONTROLE ESPECIAL (VIA 1)</div>

        <div class="paciente-box">
            <strong>Paciente:</strong> {{ paciente.nome }}<br>
            <strong>Endereço:</strong> {{ paciente.municipio }}
        </div>

        {% for item in itens_controlados %}
        <div class="item-receita">
            <div class="med-nome">
                {{ forloop.counter }}. {{ item.medicamento_nome }} {{ item.concentracao }}
                <span style="float: right;">Quant: {{ item.quantidade }}</span>
            </div>
            <div class="posologia">
                <strong>Uso:</strong> {{ item.posologia }}
            </div>
        </div>
        {% endfor %}

        <div class="assinatura">
            <strong>{{ usuario.get_full_name }}</strong><br>
            {{ usuario.tipo_registro }}: {{ usuario.registro_profissional }}<br>
            AME Caraguatatuba
        </div>
    {% endif %}

</body>
</html>