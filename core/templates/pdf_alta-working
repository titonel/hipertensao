{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Alta - {{ paciente.nome }}</title>
    <style>
        @page {
            size: a4 portrait;
            margin: 1cm;

            /* DEFINI√á√ÉO DOS FRAMES (MOLDURAS FIXAS) */
            /* Header: 3cm de altura */
            @frame header_frame {
                -pdf-frame-content: header_content;
                left: 1cm; width: 19cm; top: 0.5cm; height: 3cm;
            }
            /* Footer: 1.5cm de altura */
            @frame footer_frame {
                -pdf-frame-content: footer_content;
                left: 1cm; width: 19cm; top: 27.5cm; height: 1.5cm;
            }
            /* Conte√∫do */
            @frame content_frame {
                left: 1cm; width: 19cm; top: 3.5cm; height: 23.5cm;
            }
        }

        body { font-family: Helvetica, Arial, sans-serif; font-size: 10pt; color: #000; }

        /* --- CORRE√á√ÉO DE PROPOR√á√ÉO DAS IMAGENS --- */

        /* Centraliza o conte√∫do dentro dos frames */
        #header_content, #footer_content {
            text-align: center;
        }

        /* Define altura fixa e largura autom√°tica para manter propor√ß√£o */
        .img-fixa-header {
            height: 2.5cm; /* Cabe no frame de 3cm */
            width: auto;   /* Ajusta largura proporcionalmente */
        }

        .img-fixa-footer {
            height: 1.2cm; /* Cabe no frame de 1.5cm */
            width: auto;   /* Ajusta largura proporcionalmente */
        }
        /* ----------------------------------------- */


        /* Estilos de Texto e Tabelas */
        .titulo-principal { color: #004587; font-size: 14pt; font-weight: bold; text-align: center; margin-bottom: 10px; }
        .dados-paciente { text-align: center; font-size: 10pt; margin-bottom: 15px; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
        .bloco { border: 1px solid #000; padding: 10px; margin-bottom: 10px; background-color: #fcfcfc; }
        .bloco-titulo { color: #F26522; font-size: 12pt; font-weight: bold; border-bottom: 1px solid #ddd; margin-bottom: 5px; }
        .subtitulo { color: #004587; font-weight: bold; font-size: 11pt; margin-top: 8px; }

        table { width: 100%; border-collapse: collapse; }
        td { vertical-align: top; padding: 2px; }
        .tab-meds { width: 100%; border: 1px solid #000; margin-top: 5px; }
        .tab-meds th { background-color: #004587; color: #fff; padding: 4px; text-align: left; }
        .tab-meds td { border: 1px solid #ccc; padding: 4px; }

        .linha-assinatura {
            border-top: 1px solid #000; width: 80%; margin: 30px auto 0;
            text-align: center; font-size: 9pt; padding-top: 5px;
        }
    </style>
</head>
<body>

    <div id="header_content">
        {% if header_b64 %}
            <img src="data:image/png;base64,{{ header_b64 }}" class="img-fixa-header" />
        {% else %}
            <h1 style="color: #004587;">AME CARAGUATATUBA</h1>
        {% endif %}
    </div>

    <div id="footer_content">
        {% if footer_b64 %}
            <img src="data:image/png;base64,{{ footer_b64 }}" class="img-fixa-footer" />
        {% else %}
            <hr>
        {% endif %}
        <div style="text-align: center; font-size: 8pt; color: #777;">
            AME Caraguatatuba - Linha de Cuidado de Hipertens√£o Arterial
        </div>
    </div>

    <div class="titulo-principal">CONTRARREFER√äNCIA E ALTA</div>
    <div class="dados-paciente">
        <strong>Paciente:</strong> {{ paciente.nome }} &nbsp;|&nbsp;
        <strong>CPF:</strong> {{ paciente.cpf }} &nbsp;|&nbsp;
        <strong>Nasc:</strong> {{ paciente.data_nascimento|date:"d/m/Y" }}
    </div>

    <div class="bloco">
        <div class="bloco-titulo">BLOCO 1: CONTRARREFER√äNCIA (UBS)</div>
        <div>Prezado colega, paciente estabilizado no AME. Seguem dados.</div>

        <div class="subtitulo">1. Diagn√≥stico</div>
        <div>(X) Hipertens√£o Prim√°ria &nbsp;&nbsp; ( ) Secund√°ria &nbsp;&nbsp; ( ) Resistente</div>

        <div class="subtitulo">2. √öltimos Dados Cl√≠nicos</div>
        <table style="width: 100%">
            <tr>
                <td><strong>PA:</strong> {{ ultima_pa }} mmHg</td>
                <td><strong>IMC:</strong> {{ ultimo_imc }} kg/m¬≤</td>
                <td><strong>TFG:</strong> ____ ml/min</td>
            </tr>
        </table>

        <div class="subtitulo">3. Meta Alvo</div>
        <div>(X) PA &lt; 140/90 mmHg &nbsp;&nbsp; ( ) PA &lt; 130/80 mmHg</div>

        <div class="subtitulo">4. Regime de Alta</div>
        <table class="tab-meds">
            <thead>
                <tr><th width="40%">F√°rmaco</th><th width="30%">Dose</th><th width="30%">Posologia</th></tr>
            </thead>
            <tbody>
                {% for med in medicamentos %}
                <tr><td>{{ med.principio_ativo }}</td><td>{{ med.dose_padrao }}</td><td>( )M ( )T ( )N</td></tr>
                {% empty %}
                <tr><td colspan="3" align="center">Sem medica√ß√£o.</td></tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="subtitulo" style="margin-top: 5px;">5. Gatilhos de Retorno</div>
        <div style="font-size: 8pt;">‚Ä¢ PA > 150/100 mantida. ‚Ä¢ Queda TFG > 30%. ‚Ä¢ Novos eventos CV.</div>
    </div>

    <table style="width: 100%; margin-top: 20px;">
        <tr><td align="center"><div class="linha-assinatura"><strong>{{ usuario.get_full_name|default:"Profissional AME" }}</strong><br>Equipe M√©dica - AME Caraguatatuba</div></td></tr>
    </table>

    <pdf:nextpage />

    <div class="titulo-principal">ORIENTA√á√ïES (VIA DO PACIENTE)</div>
    <div class="dados-paciente">
        <strong>Paciente:</strong> {{ paciente.nome }} &nbsp;|&nbsp;
        <strong>Data:</strong> {{ hoje|date:"d/m/Y" }}
    </div>

    <div class="bloco">
        <div class="bloco-titulo">BLOCO 2: MINHA SA√öDE EM DIA</div>
        <div style="margin-bottom: 10px;">Entregue a folha anterior na UBS e guarde esta.</div>

        <div class="subtitulo">üìã Metas</div>
        <div>Press√£o ideal menor ou igual a: <strong>140 por 90</strong>.</div>

        <div class="subtitulo">üíä Medicamentos</div>
        <ul>
            {% for med in medicamentos %}<li>{{ med.principio_ativo }} ({{ med.dose_padrao }})</li>{% endfor %}
        </ul>

        <div class="subtitulo">ü•ó Cuidados</div>
        <table style="width: 100%">
            <tr>
                <td><strong>Sal:</strong> Evite temperos prontos.<br><strong>Peso:</strong> Controle o peso.</td>
                <td><strong>Movimento:</strong> Caminhe 30min, 3x/sem.<br><strong>V√≠cios:</strong> Evite cigarro/√°lcool.</td>
            </tr>
        </table>

        <div class="subtitulo">üö® Alerta (V√° ao PS)</div>
        <div style="color: red; font-weight: bold;">Dor no peito, falta de ar, dor de cabe√ßa forte.</div>
    </div>

    <div style="margin-top: 20px; font-size: 9pt; border: 1px dashed #999; padding: 10px;">
        <strong>Declara√ß√£o:</strong> Recebi orienta√ß√µes. Agendarei consulta na UBS.<br>
        <em>Caraguatatuba, {{ hoje|date:"d" }} de {{ hoje|date:"F" }} de {{ hoje|date:"Y" }}.</em>
    </div>

    <table style="width: 100%; margin-top: 10px;">
        <tr><td align="center"><div class="linha-assinatura"><strong>{{ paciente.nome }}</strong><br>Assinatura do Paciente</div></td></tr>
    </table>

</body>
</html>